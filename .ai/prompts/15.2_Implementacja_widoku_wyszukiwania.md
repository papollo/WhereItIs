# Plan implementacji widoku Wyszukiwanie przedmiotow

## 1. Przeglad

Widok umozliwia wyszukanie przedmiotu po nazwie i przejscie do pokoju z podswietlonym meblem, w ktorym znajduje sie przedmiot. Wyszukiwanie odbywa sie po zatwierdzeniu (klik "Szukaj" lub Enter). Widok pokazuje liste wynikow albo komunikat "Brak wynikow".

## 2. Routing widoku

- Sciezka: `/search`
- Dodac trase w `frontend/src/app/app.routes.ts` przed regula `**`.

## 3. Struktura komponentow

- SearchPageComponent
  - SearchFormComponent
  - SearchResultsListComponent
    - SearchResultItemComponent
  - SearchEmptyStateComponent (opcjonalnie, jako osobny komponent komunikatu "Brak wynikow")
  - MatProgressSpinner (stan ladowania)

## 4. Szczegoly komponentow

### SearchPageComponent

- Opis komponentu: Kontener strony. Utrzymuje stan, wywoluje API, mapuje wyniki, wyswietla wyniki/empty state/blad.
- Glowne elementy: naglowek widoku, formularz wyszukiwania, lista wynikow, spinner, komunikat braku wynikow.
- Obslugiwane interakcje: submit wyszukiwania, klik w wynik, reset wyszukiwania (opcjonalnie).
- Obslugiwana walidacja:
  - `q` po trim nie moze byc puste.
  - jezeli ustawiane `limit`, musi byc 1..200 (liczba calkowita).
  - `offset` tylko gdy `limit` ustawione; `offset >= 0`.
  - `sort` w `{relevance|name|created_at}`, `order` w `{asc|desc}`.
- Typy: `SearchItemsQuery`, `SearchItemsResponseDto`, `SearchResultVM`, `SearchStateVM`.
- Propsy: brak (strona routowana).

### SearchFormComponent

- Opis komponentu: Formularz z inputem i przyciskiem "Szukaj". Emituje zdarzenie zatwierdzenia.
- Glowne elementy: `mat-form-field` + `input`, `mat-flat-button`.
- Obslugiwane interakcje: `submit`, `input` change, Enter.
- Obslugiwana walidacja: `q` niepuste po trim; pokazanie bledu inline.
- Typy: `SearchFormVM`, `SearchFormErrors`.
- Propsy: `query: string`, `disabled: boolean`, `error?: string`; Output: `submit(query: string)`.

### SearchResultsListComponent

- Opis komponentu: Renderuje liste wynikow wyszukiwania.
- Glowne elementy: lista `mat-list` lub `section` z `SearchResultItemComponent`.
- Obslugiwane interakcje: klik w element listy.
- Obslugiwana walidacja: brak (tylko prezentacja).
- Typy: `SearchResultVM`.
- Propsy: `items: SearchResultVM[]` + Output `open(result: SearchResultVM)`.

### SearchResultItemComponent

- Opis komponentu: Pojedynczy wynik z informacja o przedmiocie, meblu i pokoju.
- Glowne elementy: nazwa przedmiotu, etykieta mebla i pokoju, przycisk lub caly wiersz klikalny.
- Obslugiwane interakcje: `click`.
- Obslugiwana walidacja: brak.
- Typy: `SearchResultVM`.
- Propsy: `item: SearchResultVM`.

### SearchEmptyStateComponent (opcjonalny)

- Opis komponentu: Prosty komunikat "Brak wynikow" po wykonaniu wyszukiwania.
- Glowne elementy: tekst, ewentualnie ikona.
- Obslugiwane interakcje: brak.
- Obslugiwana walidacja: brak.
- Typy: brak dodatkowych.
- Propsy: `visible: boolean` (opcjonalnie).

## 5. Typy

- `SearchItemsQuery` (istniejacy): `{ q: string; limit?: number; offset?: number; sort?: SearchOrderBy; order?: SearchOrderDirection }`
- `SearchItemResultDto` (istniejacy): `{ item_id; item_name; furniture: { id; name }; room: { id; name } }`
- `SearchItemsResponseDto` (istniejacy): `{ data: SearchItemResultDto[] }`
- `SearchResultVM` (nowy):
  - `itemId: string`
  - `itemName: string`
  - `furnitureId: string`
  - `furnitureName: string`
  - `roomId: string`
  - `roomName: string`
- `SearchStateVM` (nowy):
  - `query: string`
  - `results: SearchResultVM[]`
  - `isLoading: boolean`
  - `hasSearched: boolean`
  - `error?: string`
- `SearchFormVM` (nowy):
  - `value: string`
  - `error?: string`
- `SearchFormErrors` (nowy): `{ q?: string }`

## 6. Zarzadzanie stanem

- Lokalny stan w `SearchPageComponent` lub `SearchFacade` z `BehaviorSubject`:
  - `query`, `results`, `isLoading`, `hasSearched`, `error`.
- `hasSearched` rozroznia pierwszy widok od stanu "Brak wynikow".
- Walidacja klienta przed wywolaniem API; w przypadku bledu ustawienie `error` i brak wywolania.

## 7. Integracja API

- Uzycie `SearchApi.searchItems(query: SearchItemsQuery)` z `frontend/src/app/search/search.api.ts`.
- Request:
  - `q` wymagane (trim), `limit` np. 20, `offset` opcjonalnie 0.
  - `sort` domyslnie `relevance`.
- Response:
  - Mapowanie `SearchItemsResponseDto.data` -> `SearchResultVM`.
- Obsuga bledow:
  - `ApiError.validation` mapowany do bledu formularza.
  - `ApiError` inne -> snackbar.

## 8. Interakcje uzytkownika

- Wpisanie tekstu w input i klik "Szukaj" / Enter -> wywolanie wyszukiwania.
- Wynik klikalny -> nawigacja do `/rooms/:roomId` z `queryParams: { furnitureId }` (podswietlenie mebla).
- Brak wynikow -> widoczny komunikat "Brak wynikow".
- Blad serwera -> snackbar w prawym gornym rogu.

## 9. Warunki i walidacja

- `q.trim().length > 0` wymagane.
- `limit` jesli uzyte: liczba calkowita 1..200.
- `offset` jesli uzyte: `>= 0` i tylko gdy `limit` ustawione.
- `sort` i `order` tylko z dozwolonych wartosci.
- Przycisk "Szukaj" aktywny tylko gdy query niepuste.

## 10. Obsluga bledow

- Blad walidacji: inline pod inputem, bez requestu.
- Blad 400 (missing query): pokazac komunikat walidacji i nie wyswietlac wynikow.
- Blad 401/500/network: snackbar z czytelnym komunikatem; zachowac poprzednie wyniki.
- Brak wynikow: wyswietlic pusty stan po wykonanym wyszukiwaniu.

## 11. Kroki implementacji

1. Dodac trase `/search` do `frontend/src/app/app.routes.ts`.
2. Utworzyc `SearchPageComponent` (standalone) z podstawowym layoutem.
3. Dodac `SearchFormComponent` z walidacja `q` i emitowaniem submit.
4. Dodac `SearchResultsListComponent` i `SearchResultItemComponent`.
5. Dodac `SearchResultVM`, `SearchStateVM`, `SearchFormVM` w `frontend/src/app/search/search.view-models.ts`.
6. Zintegrowac `SearchApi.searchItems`, mapowac wyniki do VM, obsluzyc `isLoading` i `hasSearched`.
7. Dodac nawigacje do pokoju z `queryParams: { furnitureId }`.
8. Dodac obsluge bledow (inline + snackbar).
9. Dodac podstawowe testy jednostkowe dla walidacji formularza i mapowania wynikow (opcjonalnie).
