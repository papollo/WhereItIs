@if (state$ | async; as state) {
  <section class="room-details">
    @if (state.isLoading) {
      <div class="room-details__loading">
        <mat-progress-spinner diameter="32"></mat-progress-spinner>
        <span>Laduje pokoj...</span>
      </div>
    }
    @if (state.notFound && !state.isLoading) {
      <section class="room-details__empty">
        <h1>Nie znaleziono pokoju</h1>
        <p>Sprawdz, czy link jest poprawny.</p>
        <button mat-stroked-button color="primary" routerLink="/rooms">Wroc do listy</button>
      </section>
    }
    @if (!state.notFound && state.room) {
      <section class="room-details__content">
        <header class="room-details__header">
          <div class="room-details__title">
            <span class="room-details__color" [style.backgroundColor]="state.room.color"></span>
            <div>
              <h1>{{ state.room.name }}</h1>
            </div>
          </div>
          <button mat-flat-button color="primary" type="button" (click)="addFurniture(state.room.id)">
            Dodaj mebel
          </button>
        </header>
        <section class="room-details__grid">
          <app-room-grid-preview
            [cells]="state.cells"
            [cellSizePx]="16"
            [fillColor]="state.room.color"
            [placements]="state.placements"
            [highlightedFurnitureId]="isItemsDialogOpen ? undefined : highlightedFurnitureId"
            [hoveredFurnitureId]="hoveredFurnitureId"
            [resetHoverToken]="resetHoverToken"
          ></app-room-grid-preview>
          @if (state.cells.length === 0) {
            <p class="room-details__hint">
              Brak zapisanej siatki dla tego pokoju.
            </p>
          }
        </section>
        <section class="room-details__furniture">
          <header class="room-details__section-header">
            <h2>Meble</h2>
            <span>{{ state.furniture.length }} szt.</span>
          </header>
          @if (state.error) {
            <p class="room-details__error">{{ describeError(state.error) }}</p>
          }
          @if (state.furniture.length > 0) {
            <app-furniture-list
              [items]="state.furniture"
              [highlightedId]="highlightedFurnitureId"
              (open)="openFurniture(state.room.id, $event)"
              (edit)="editFurniture(state.room.id, $event)"
              (delete)="deleteFurniture($event)"
              (hover)="setHoveredFurniture($event)"
            ></app-furniture-list>
          }
          @if (state.furniture.length === 0) {
            <section class="room-details__empty">
              <p>Brak mebli w tym pokoju.</p>
              <button mat-stroked-button color="primary" type="button" (click)="addFurniture(state.room.id)">
                Dodaj pierwszy mebel
              </button>
            </section>
          }
        </section>
      </section>
    }
  </section>
}
