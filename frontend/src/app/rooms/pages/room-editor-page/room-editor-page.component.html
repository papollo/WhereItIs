@if (state$ | async; as state) {
  <section class="room-editor">
    <header class="room-editor__header">
      <div>
        <h1>{{ isEdit ? 'Edytuj pokoj' : 'Nowy pokoj' }}</h1>
        <p>Wypelnij dane i zaznacz ksztalt pokoju na siatce.</p>
      </div>
      <a mat-stroked-button routerLink="/rooms">Wroc do listy</a>
    </header>

    @if (state.isLoading) {
      <div class="room-editor__loading">
        <mat-progress-spinner diameter="32"></mat-progress-spinner>
        <span>Laduje dane pokoju...</span>
      </div>
    }

    @if (state.notFound && !state.isLoading) {
      <section class="room-editor__empty">
        <h2>Nie znaleziono pokoju</h2>
        <p>Sprawdz, czy link jest poprawny.</p>
      </section>
    }

    @if (!state.notFound) {
      <section class="room-editor__content">
        <app-room-form [value]="formValue" (valueChange)="updateForm($event)"></app-room-form>

        <div class="room-editor__grid">
          <h2>Siatka pokoju</h2>
          <p class="room-editor__hint">
            Kliknij komorki, aby je zaznaczyc. Kolejne komorki musza sie stykac.
          </p>
          <app-room-grid-editor [grid]="gridState" (setCell)="setCell($event)"></app-room-grid-editor>
          @if (validationError) {
            <p class="room-editor__error">{{ validationError }}</p>
          }
        </div>

        <app-room-editor-actions
          [canSave]="canSave()"
          [isSaving]="state.isSaving"
          (saveAction)="save()"
          (cancelAction)="cancel()"
        ></app-room-editor-actions>
      </section>
    }
  </section>
}
