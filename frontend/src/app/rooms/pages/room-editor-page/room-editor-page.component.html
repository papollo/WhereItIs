@if (state$ | async; as state) {
  <section class="room-editor">
    <header class="room-editor__header">
      <div>
        <h1>{{ isEdit ? 'Edytuj pokoj' : 'Nowy pokoj' }}</h1>
        <p>Wypelnij dane i zaznacz ksztalt pokoju na siatce.</p>
      </div>
      <a mat-stroked-button routerLink="/rooms">Wroc do listy</a>
    </header>

    @if (state.isLoading) {
      <div class="room-editor__loading">
        <mat-progress-spinner diameter="32"></mat-progress-spinner>
        <span>Laduje dane pokoju...</span>
      </div>
    }

    @if (state.notFound && !state.isLoading) {
      <section class="room-editor__empty">
        <h2>Nie znaleziono pokoju</h2>
        <p>Sprawdz, czy link jest poprawny.</p>
      </section>
    }

      @if (!state.notFound) {
      <section class="room-editor__content">
        <div class="room-editor__left">
          <div class="room-editor__form">
            <app-room-form [value]="formValue" (valueChange)="updateForm($event)"></app-room-form>
          </div>
          <div class="room-editor__brush-panel">
            <span class="room-editor__brush-label">Szerokosc pedzla</span>
            <mat-button-toggle-group
              class="room-editor__brush"
              [value]="brushSize"
              (valueChange)="setBrushSize($event)"
              aria-label="Rozmiar pedzla"
            >
              <mat-button-toggle [value]="1">1x1</mat-button-toggle>
              <mat-button-toggle [value]="3">3x3</mat-button-toggle>
              <mat-button-toggle [value]="5">5x5</mat-button-toggle>
            </mat-button-toggle-group>
          </div>
          <app-room-editor-actions
            class="room-editor__actions"
            [canSave]="canSave()"
            [isSaving]="state.isSaving"
            [showCancel]="isEdit"
            (saveAction)="save()"
            (cancelAction)="cancel()"
          ></app-room-editor-actions>
        </div>

        <div class="room-editor__grid">
          <app-room-grid-editor
            [grid]="gridState"
            [fillColor]="formValue.color"
            [brushSize]="brushSize"
            (setCell)="setCell($event)"
          ></app-room-grid-editor>
          @if (validationError) {
            <p class="room-editor__error">{{ validationError }}</p>
          }
        </div>

      </section>
    }
  </section>
}
